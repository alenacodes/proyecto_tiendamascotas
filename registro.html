<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/style_formulario.css">
  <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper)  -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
     -->
  
  <title>Ingresa tus datos</title>
</head>
<body>
  <section class="form-register" id="Registro">
    <h4>¡Regístrate!</h4>
    <input type="text" class="controls"  id="inputNombre1" placeholder="Primer Nombre">
    <input type="text" class="controls"  id="inputNombre2" placeholder="Segundo Nombre">
    <input class="controls" type="text" id="inputApellido1" placeholder="Primer Apellido">
    <input class="controls" type="text" id="inputApellido2" placeholder="Segundo Apellido">
    <input class="controls" type="email"  id="inputCorreo" placeholder="Ingrese su Correo">
    <input class="controls" type="password" id="inputPassword" placeholder="Ingrese su Contraseña">
    <input class="controls" type="text" id="inputFono" placeholder="Ingrese su telefono">
    <input class="controls" type="text" id="inputDireccion" placeholder="Ingrese su Dirección">
    <select class="controls" required="required" id="comunas" name="comunas" placeholder="Seleccione comuna">
    <option id="nom-comuna" value="-1">Seleccione comuna</option></select>

    <p>Estoy de acuerdo con <a href="" id="condiciones">Términos y Condiciones</a></p>
    <br>
    <center><a id="btnRegistrarUsuario" class="btn btn-primary" type="submit">Registrar</a></center>
    <br>    
    <p><a href="index.html">¿Tienes una Cuenta?</a></p>
  </section>
  <!--  Codigo by Manu-->
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    
  <script>
    const API_URL = 'http://127.0.0.1:5000/';

    //Iniciar el formulario 
    

    $(document).ready(function(){
      limpiarFormulario();
    });
    
     const arrayComunas = [
                         {id:1, nombre:'Antartica'},
                          {id:273, nombre:'Cerrillos'},
                          {id:274, nombre:'Cerro Navia'},
                          {id:275, nombre:'Conchalí'},
                          {id:276, nombre:'El Bosque'},
                          {id:277, nombre:'Estación Central'},
                          {id:278, nombre: 'Huechuraba'},
                          {id:279, nombre: 'Independencia'},
                          {id:280, nombre: 'La Cisterna'},
                          {id:281, nombre: 'La Florida'},
                          {id:282, nombre: 'La Granja'},
                          {id:283, nombre: 'La Pintana'},
                          {id:284, nombre: 'La Reina'},
                          {id:285, nombre: 'Las Condes'},
                          {id:286, nombre: 'Lo Barnechea'},
                          {id:287, nombre: 'Lo Espejo'},
                          {id:288, nombre: 'Lo Prado'},
                          {id:289, nombre: 'Macul'},
                          {id:290, nombre: 'Maipú'},
                          {id:304, nombre: 'Ñuñoa'},
                          {id:291, nombre: 'Pedro Aguirre Cerda'},
                          {id:292, nombre: 'Peñalolén'},
                          {id:293, nombre: 'Providencia'},
                          {id:294, nombre: 'Pudahuel'},
                          {id:295, nombre: 'Quilicura'},
                          {id:296, nombre: 'Quinta Normal'},
                          {id:297, nombre: 'Recoleta'},
                          {id:298, nombre: 'Renca'},
                          {id:208, nombre:'San Bernardo'},
                          {id:299, nombre: 'San Joaquín'},
                          {id:129, nombre: 'San José de Maipo'},
                          {id:300, nombre: 'San Miguel'},
                          {id:228, nombre: 'San Pedro'},
                          {id:301, nombre: 'San Ramón'},
                          {id:302, nombre: 'Santiago'},
                          {id:303, nombre: 'Vitacura'},
                          {id:128, nombre: 'Puente Alto'},
                          {id:127, nombre: 'Pirque'},
                          {id:234, nombre: 'San José de La Costa'},
                          {id:84, nombre: 'Lampa'}
                          
                          
                          
  ];
       
    
 
    function cargar_comunas(){
      
      arrayComunas.sort();
      arrayComunas.forEach(function(comuna){
        $('#comunas').append('<option value="'+comuna.id+'">'+comuna.nombre+'</option>');
      });
    }
          
    cargar_comunas();
    
    $(document).on('click', '#condiciones', function(){ //Evento click en el link de las condiciones
      alert(' Gracias por estar de acuerdo con los términos y condiciones '
        +' Esperamos que disfrute de nuestros servicios');
    });

    //Registrar un nuevo usuario al hacer click en el boton  (Tabla Usuario Histórico)
    $(document).on('click', '#btnRegistrarUsuario', function(){
      //obtener los datos del usuario
      
      var correo = $('#inputCorreo').val();
      var password = $('#inputPassword').val();
      var estado = 1;  //1 = activo, 0 = inactivo
      var nombre1 = $('#inputNombre1').val();
      var nombre2 = $('#inputNombre2').val();
      var apellido1 = $('#inputApellido1').val();
      var apellido2 = $('#inputApellido2').val();
      var direccion = $('#inputDireccion').val();
      var fono = $('#inputFono').val();
      var comuna = $('#comunas').val();
      
      if (correo == '' || password == '' || nombre1 == '' || nombre2 == '' || apellido1 == '' || apellido2 == '' || direccion == '' || fono == '' || comuna == ''){
        alert('Debe llenar todos los campos!');
        
      }
      else{
      //cargar los datos mediante ajax
      $.ajax({
        url: API_URL+'usuarios', 
        type: 'POST',  
        contentType: 'application/json',
        data: JSON.stringify({
          
          correo: correo,
          password: password,
          estado: estado,
          primer_nombre: nombre1,
          segundo_nombre: nombre2,
          primer_apellido: apellido1,
          segundo_apellido: apellido2,
          direccion: direccion,
          fono: fono,
          comuna: comuna
                    
        }),
        success: function(respuesta) {
          console.log(respuesta);
         
         }
      })
    }
    });
    
    //Registrar un nuevo usuario al hacer click en el boton
    $(document).on('click', '#btnRegistrarUsuario', function(){
      //obtener los datos del usuario
      
      var correo = $('#inputCorreo').val();
      var password = $('#inputPassword').val();
      var estado = 1;  //1 = activo, 0 = inactivo
      var nombre1 = $('#inputNombre1').val();
      var nombre2 = $('#inputNombre2').val();
      var apellido1 = $('#inputApellido1').val();
      var apellido2 = $('#inputApellido2').val();
      var direccion = $('#inputDireccion').val();
      var fono = $('#inputFono').val();
      var comuna = $('#comunas').val();
      if (correo == '' || password == '' || nombre1 == '' || apellido1 == '' || direccion == '' || fono == '' || comuna == ''){
        alert('Debe llenar todos los campos correo, password, nombre, apellido, direccion, fono y comuna!');
        
      }
      else{
      //console.log(comuna)

      // para comprobar que se capturan los datos del form
      //console.log(correo, password, estado, nombre1, nombre2, apellido1, apellido2, direccion, fono, comuna);

      //cargar los datos mediante ajax
      $.ajax({
        url: API_URL+'usuario_car', 
        type: 'POST',  
        contentType: 'application/json',
        data: JSON.stringify({
          
          correo: correo,
          password: password,
          estado: estado,
          primer_nombre: nombre1,
          segundo_nombre: nombre2,
          primer_apellido: apellido1,
          segundo_apellido: apellido2,
          direccion: direccion,
          fono: fono,
          comuna: comuna
                    
        }),
        success: function(respuesta) {
          console.log(respuesta);
         
         }
      })
    }
    });


    function limpiarFormulario(){
      $('#inputCorreo').val('');
      $('#inputPassword').val('');
      $('#inputNombre1').val('');
      $('#inputNombre2').val('');
      $('#inputApellido1').val('');
      $('#inputApellido2').val('');
      $('#inputDireccion').val('');
      $('#inputFono').val('');
      $('#comunas').val('');

      
      /*

      $('#btnAgregarUsuario').show();
      $('#btnEditarUsuarioTabla').hide();
      $('#btnCancelarEdicion').hide();
      */
    }
    


  </script>
</body>
</html>
